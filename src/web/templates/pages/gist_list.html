{{define "gist_list"}}
{{template "base" .}}
{{end}}

{{define "content"}}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">My Gists</h1>
        <a href="/gists/new" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            <i class="fas fa-plus mr-2"></i> New Gist
        </a>
    </div>
    
    <!-- Filters -->
    <div class="mb-6 flex flex-wrap gap-4">
        <select class="rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm"
                hx-get="/gists" hx-target="#gist-list" hx-push-url="true" name="visibility">
            <option value="">All Gists</option>
            <option value="public" {{if eq .Filter "public"}}selected{{end}}>Public</option>
            <option value="unlisted" {{if eq .Filter "unlisted"}}selected{{end}}>Unlisted</option>
            <option value="private" {{if eq .Filter "private"}}selected{{end}}>Private</option>
        </select>
        
        <div class="flex-1">
            <input type="search" placeholder="Search gists..." 
                   class="w-full rounded-md border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm"
                   hx-get="/gists" hx-target="#gist-list" hx-trigger="keyup changed delay:500ms" name="q">
        </div>
    </div>
    
    <!-- Gist List -->
    <div id="gist-list" class="space-y-4">
        {{if .Gists}}
            {{range .Gists}}
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm hover:shadow-md transition-shadow p-6 border border-gray-200 dark:border-gray-700">
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <a href="/gists/{{.ID}}" class="hover:text-indigo-600 dark:hover:text-indigo-400">
                                {{if .Title}}{{.Title}}{{else}}Untitled Gist{{end}}
                            </a>
                        </h3>
                        {{if .Description}}
                        <p class="mt-1 text-gray-600 dark:text-gray-300">{{.Description}}</p>
                        {{end}}
                        
                        <div class="mt-3 flex flex-wrap gap-4 text-sm text-gray-500 dark:text-gray-400">
                            <span>
                                <i class="fas fa-clock mr-1"></i>
                                {{.UpdatedAt.Format "Jan 2, 2006 3:04 PM"}}
                            </span>
                            {{if .Files}}
                            <span>
                                <i class="fas fa-file mr-1"></i>
                                {{len .Files}} {{if eq (len .Files) 1}}file{{else}}files{{end}}
                            </span>
                            {{end}}
                            {{if .Language}}
                            <span>
                                <i class="fas fa-code mr-1"></i>
                                {{.Language}}
                            </span>
                            {{end}}
                            <span>
                                <i class="fas fa-star mr-1"></i>
                                {{.StarCount}} stars
                            </span>
                        </div>
                    </div>
                    
                    <div class="ml-4 flex items-center space-x-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {{if eq .Visibility "public"}}bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200{{end}}
                            {{if eq .Visibility "unlisted"}}bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200{{end}}
                            {{if eq .Visibility "private"}}bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200{{end}}">
                            <i class="fas fa-{{if eq .Visibility "public"}}globe{{else if eq .Visibility "unlisted"}}link{{else}}lock{{end}} mr-1"></i>
                            {{.Visibility}}
                        </span>
                        
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = !open" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                                <i class="fas fa-ellipsis-v"></i>
                            </button>
                            <div x-show="open" @click.away="open = false" x-transition
                                 class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-10">
                                <div class="py-1">
                                    <a href="/gists/{{.ID}}/edit" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-edit mr-2"></i> Edit
                                    </a>
                                    <a href="/gists/{{.ID}}/raw" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-file-code mr-2"></i> Raw
                                    </a>
                                    <button hx-delete="/api/v1/gists/{{.ID}}" 
                                            hx-confirm="Are you sure you want to delete this gist?"
                                            hx-target="closest .bg-white"
                                            hx-swap="outerHTML"
                                            class="block w-full text-left px-4 py-2 text-sm text-red-700 dark:text-red-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                                        <i class="fas fa-trash mr-2"></i> Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        {{else}}
            <div class="text-center py-12">
                <i class="fas fa-file-code text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">No gists yet</h3>
                <p class="text-gray-600 dark:text-gray-400 mb-4">Create your first gist to get started.</p>
                <a href="/gists/new" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    <i class="fas fa-plus mr-2"></i> Create New Gist
                </a>
            </div>
        {{end}}
    </div>
    
    <!-- Pagination -->
    {{if .HasPages}}
    <nav class="mt-8 flex items-center justify-between">
        <div class="flex-1 flex justify-between sm:hidden">
            {{if .PrevPage}}
            <a href="?page={{.PrevPage}}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                Previous
            </a>
            {{end}}
            {{if .NextPage}}
            <a href="?page={{.NextPage}}" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
                Next
            </a>
            {{end}}
        </div>
        
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
                <p class="text-sm text-gray-700 dark:text-gray-300">
                    Showing <span class="font-medium">{{.StartIndex}}</span> to <span class="font-medium">{{.EndIndex}}</span> of
                    <span class="font-medium">{{.TotalCount}}</span> results
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    {{if .PrevPage}}
                    <a href="?page={{.PrevPage}}" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    {{end}}
                    
                    {{range .Pages}}
                        {{if eq . $.CurrentPage}}
                        <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-indigo-50 dark:bg-indigo-900 text-sm font-medium text-indigo-600 dark:text-indigo-400">
                            {{.}}
                        </span>
                        {{else}}
                        <a href="?page={{.}}" class="relative inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                            {{.}}
                        </a>
                        {{end}}
                    {{end}}
                    
                    {{if .NextPage}}
                    <a href="?page={{.NextPage}}" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm font-medium text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                    {{end}}
                </nav>
            </div>
        </div>
    </nav>
    {{end}}
</div>
{{end}}