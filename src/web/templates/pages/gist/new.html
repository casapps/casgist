{{define "content"}}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <form hx-post="/api/v1/gists" 
          hx-ext="json-enc"
          hx-redirect="/gists/{id}"
          class="space-y-6">
        
        <!-- Header -->
        <div class="border-b border-gray-700 pb-6">
            <h1 class="text-2xl font-bold text-gray-100">Create a new gist</h1>
            <p class="mt-1 text-sm text-gray-400">
                Gists are a simple way to share snippets and pastes with others.
            </p>
        </div>

        <!-- Gist Description -->
        <div>
            <label for="description" class="block text-sm font-medium text-gray-300">
                Gist description (optional)
            </label>
            <input type="text" 
                   name="description" 
                   id="description"
                   placeholder="Description of your gist..."
                   class="mt-1 block w-full rounded-md bg-gray-800 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500">
        </div>

        <!-- Files -->
        <div id="files-container" class="space-y-4">
            <div class="file-entry border border-gray-700 rounded-lg p-4" data-file-index="0">
                <div class="space-y-4">
                    <div class="flex items-center space-x-4">
                        <input type="text" 
                               name="files[0].filename" 
                               placeholder="Filename including extension..."
                               class="flex-1 rounded-md bg-gray-800 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                               required>
                        <select name="files[0].language" 
                                class="rounded-md bg-gray-800 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                                onchange="updateSyntaxHighlighting(this)">
                            <option value="">Auto-detect</option>
                            <option value="javascript">JavaScript</option>
                            <option value="python">Python</option>
                            <option value="go">Go</option>
                            <option value="rust">Rust</option>
                            <option value="java">Java</option>
                            <option value="csharp">C#</option>
                            <option value="cpp">C++</option>
                            <option value="php">PHP</option>
                            <option value="ruby">Ruby</option>
                            <option value="swift">Swift</option>
                            <option value="kotlin">Kotlin</option>
                            <option value="typescript">TypeScript</option>
                            <option value="html">HTML</option>
                            <option value="css">CSS</option>
                            <option value="sql">SQL</option>
                            <option value="bash">Bash</option>
                            <option value="yaml">YAML</option>
                            <option value="json">JSON</option>
                            <option value="markdown">Markdown</option>
                            <option value="plaintext">Plain Text</option>
                        </select>
                        <button type="button" 
                                onclick="removeFile(this)" 
                                class="text-red-500 hover:text-red-400 p-2"
                                title="Remove file">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="relative">
                        <textarea name="files[0].content" 
                                  rows="10"
                                  placeholder="Enter your code here..."
                                  class="w-full font-mono text-sm rounded-md bg-gray-900 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                                  required></textarea>
                        <button type="button" 
                                onclick="formatCode(this)" 
                                class="absolute top-2 right-2 text-gray-400 hover:text-gray-200 text-sm"
                                title="Format code">
                            <i class="fas fa-indent"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add File Button -->
        <div>
            <button type="button" 
                    onclick="addFile()" 
                    class="text-blue-400 hover:text-blue-300 text-sm font-medium">
                <i class="fas fa-plus mr-1"></i> Add another file
            </button>
        </div>

        <!-- Privacy Options -->
        <div class="border-t border-gray-700 pt-6">
            <h3 class="text-lg font-medium text-gray-100 mb-4">Privacy</h3>
            <div class="space-y-3">
                <label class="flex items-center cursor-pointer">
                    <input type="radio" 
                           name="is_public" 
                           value="true" 
                           checked
                           class="mr-2 text-blue-600 bg-gray-800 border-gray-600">
                    <div>
                        <span class="text-sm font-medium text-gray-100">Public</span>
                        <p class="text-xs text-gray-400">Anyone can see this gist</p>
                    </div>
                </label>
                <label class="flex items-center cursor-pointer">
                    <input type="radio" 
                           name="is_public" 
                           value="false"
                           class="mr-2 text-blue-600 bg-gray-800 border-gray-600">
                    <div>
                        <span class="text-sm font-medium text-gray-100">Private</span>
                        <p class="text-xs text-gray-400">Only you can see this gist</p>
                    </div>
                </label>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="flex justify-between pt-6 border-t border-gray-700">
            <a href="/gists" class="px-4 py-2 text-gray-400 hover:text-gray-200">
                Cancel
            </a>
            <div class="space-x-3">
                <button type="submit" 
                        name="action" 
                        value="draft"
                        class="px-4 py-2 bg-gray-700 text-gray-100 rounded-md hover:bg-gray-600">
                    Save as Draft
                </button>
                <button type="submit" 
                        name="action" 
                        value="create"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                    Create Gist
                </button>
            </div>
        </div>
    </form>
</div>

<script>
let fileIndex = 0;

function addFile() {
    fileIndex++;
    const container = document.getElementById('files-container');
    const fileEntry = document.createElement('div');
    fileEntry.className = 'file-entry border border-gray-700 rounded-lg p-4';
    fileEntry.setAttribute('data-file-index', fileIndex);
    
    fileEntry.innerHTML = `
        <div class="space-y-4">
            <div class="flex items-center space-x-4">
                <input type="text" 
                       name="files[${fileIndex}].filename" 
                       placeholder="Filename including extension..."
                       class="flex-1 rounded-md bg-gray-800 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                       required>
                <select name="files[${fileIndex}].language" 
                        class="rounded-md bg-gray-800 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                        onchange="updateSyntaxHighlighting(this)">
                    <option value="">Auto-detect</option>
                    <option value="javascript">JavaScript</option>
                    <option value="python">Python</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="java">Java</option>
                    <option value="csharp">C#</option>
                    <option value="cpp">C++</option>
                    <option value="php">PHP</option>
                    <option value="ruby">Ruby</option>
                    <option value="swift">Swift</option>
                    <option value="kotlin">Kotlin</option>
                    <option value="typescript">TypeScript</option>
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="sql">SQL</option>
                    <option value="bash">Bash</option>
                    <option value="yaml">YAML</option>
                    <option value="json">JSON</option>
                    <option value="markdown">Markdown</option>
                    <option value="plaintext">Plain Text</option>
                </select>
                <button type="button" 
                        onclick="removeFile(this)" 
                        class="text-red-500 hover:text-red-400 p-2"
                        title="Remove file">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="relative">
                <textarea name="files[${fileIndex}].content" 
                          rows="10"
                          placeholder="Enter your code here..."
                          class="w-full font-mono text-sm rounded-md bg-gray-900 border-gray-600 text-gray-100 focus:border-blue-500 focus:ring-blue-500"
                          required></textarea>
                <button type="button" 
                        onclick="formatCode(this)" 
                        class="absolute top-2 right-2 text-gray-400 hover:text-gray-200 text-sm"
                        title="Format code">
                    <i class="fas fa-indent"></i>
                </button>
            </div>
        </div>
    `;
    
    container.appendChild(fileEntry);
}

function removeFile(button) {
    const fileEntry = button.closest('.file-entry');
    const container = document.getElementById('files-container');
    
    // Don't remove if it's the last file
    if (container.querySelectorAll('.file-entry').length > 1) {
        fileEntry.remove();
    } else {
        alert('You must have at least one file in your gist');
    }
}

function updateSyntaxHighlighting(select) {
    // This would update syntax highlighting in real-time
    // For now, it's a placeholder for future enhancement
    const language = select.value;
    const textarea = select.closest('.file-entry').querySelector('textarea');
    textarea.setAttribute('data-language', language);
}

function formatCode(button) {
    // Placeholder for code formatting functionality
    // Could integrate with prettier or similar
    alert('Code formatting will be available soon!');
}

// Auto-detect language from filename
document.addEventListener('input', function(e) {
    if (e.target.name && e.target.name.includes('.filename')) {
        const filename = e.target.value;
        const ext = filename.split('.').pop().toLowerCase();
        const select = e.target.closest('.file-entry').querySelector('select');
        
        const languageMap = {
            'js': 'javascript',
            'ts': 'typescript',
            'py': 'python',
            'go': 'go',
            'rs': 'rust',
            'java': 'java',
            'cs': 'csharp',
            'cpp': 'cpp',
            'cc': 'cpp',
            'c': 'cpp',
            'php': 'php',
            'rb': 'ruby',
            'swift': 'swift',
            'kt': 'kotlin',
            'html': 'html',
            'css': 'css',
            'sql': 'sql',
            'sh': 'bash',
            'yml': 'yaml',
            'yaml': 'yaml',
            'json': 'json',
            'md': 'markdown',
            'txt': 'plaintext'
        };
        
        if (languageMap[ext]) {
            select.value = languageMap[ext];
        }
    }
});
</script>
{{end}}